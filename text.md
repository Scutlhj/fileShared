# 《代码大全2》20-26章读书笔记

## 第20章：软件质量概述

### 软件质量的特征

分为外在与内在特征。外在指的是用户能感受到的，内在指的是代码质量
外在特征包括：
- 正确性：实现的功能是否正确
- 可用性：好不好上手
- 效率：内存与执行时间
- 可靠性：无故障时间
- 完整性：阻止未经验证或不正确访问的能力
- 适应性：能否兼容其他环境
- 精确性：结果误差成都
- 健壮性：接受无效输入或处于压力环境时继续运行的能力
部分特性会存在重叠，不同场合重要性不同

内在特征包括：
- 可维护性：好不好改
- 灵活性：兼容多种环境或不同用途
- 可移植性：适配不同环境的难度
- 可重用性：能否复用代码到其他系统
- 可读性：代码是否可读
- 可测试性
- 可理解性：可读性之上的理解

内在特性会影响外在特性，且部分内在特性间存在冲突

### 改善软件质量的技术

普遍的技术：
- 明确定义软件的质量目标，即应该关注哪些外在质量，并明确规定质量需要保证。目标不能随意变动。
- 测试。
- 需要一套软件构件指南，相当于是一份内部文档，规定了解决哪些问题、采用什么架构、约定哪些编码风格、如何进行测试等。
- 正式与非正式技术复查。

开发过程中：
- 不要毫无节制地变更需求。
- 对结果进行量化。
- 制作原型：相当于设计文档，帮助开发

需要结合多种技术进行改善：Glenford Myers指出，在查找某些特定类型的错误时，人工方法(比如检查和通读代码)往往比用计算机更得心应手，而对另外一些错误类型则正好相反(1979年)。这个结果在后来的一项研究中得到了肯定，该研究发现，阅读代码能够找出较多的接口缺陷，而功能测试则可以检测出更多的控制缺陷(Basili，Selby andHutchens 1986)。

一个错误待的时间越长，修正成本就越大。
另外，人工阅读发现的错误属于“一步到位”型错误，可以直接修改，成本较低；测试发现的错误还需要进行调试分析才能找到，因而成本较高。

### 什么时候需要改善

越早越好

### 软件质量的普遍原理

更高质量的软件不一定会耗费更多时间，反而会节约很多返工的时间。

缺陷最少的软件项目的开发计划时间最短，并拥有最高的开发生产率……消除软件缺陷实际上是最昂贵且最耗时的一种软件工作(Jones 2000)。

## 第21章：协同构建

### 什么是协同开发

“协同构建”包括结对编程、正式检查、非正式技术复查、文档阅读，以及其他让开发人员共同承担创建代码及其他工作产品责任的技术。
各种协同构建技术之间尽管存在着一些差异,但它们都基于一个相同的思想，那就是在工作中开发人员总会对某些错误点视而不见，而其他人不会有相同的点，所以开发人员让其他人来检查自己的工作是很有好处的。

### 结对编程

结对编程的核心思想在于一个人进行编程，另一个人注意检查有没有错误，并考虑设计与策略。

结对编程的关键：
- 要约定代码规范。不要将很多无谓的时间花在纠结代码风格上，而应该尝试对其标准化。
- 不要让结对变成旁观。不掌握键盘的人应该主动积极地检查，并且思考下一步应该做什么。
- 不要强迫在简单的问题上使用结对编程。很多问题可以讨论之后分别编程，或者对部分工作结对编程，而不需要完全结对。
- 有规律地进行人员和工作调换。对于结对双方（驾驶员和领航员）的工作调换，目的在于让双方都能熟悉系统的不同部分，并且合理地分摊工作量。
- 鼓励双方跟上彼此的步伐。
- 保证双方都能看到显示器，而且字体、亮度等应该合适。
- 不要强迫关系不好的人结对。也要避免两个新手结对。
- 如果在团体项目中使用结对方法，也还是需要指定一个组长，来协调工作并对结果负责。

结对编程的好处：
- 结对编程有利于编写高质量代码。
- 结对编程能增加代码的可读性和可维护性。
- 结对编程效率更高，而且错误更少，减少了后期维护需要的投入，从而直接间接地有利于整体进度。

### 正式检查

详查(正式检查)是一种特殊的复查，种种迹象表明它在侦测缺陷方面特别有效，并且相对测试来说更加经济合理。详查关注检测错误，而非急于对其修正。详查者和代码编写者并非一人。

详查的优点：
作者同样给出了数据表明详查能够查出很多错误。另外，通过详查，开发者可以更了解自己现有的方法有什么缺陷，如何改善工作。最后详查还可以用来检查进度。

详查中的人员角色：
- 主持人：负责管理协调各方面工作，安排进度等。
- 作者：主要在代码不够明晰时讲解自己的代码。
- 评论员：负责进行探讨、找出问题。
- 记录员。

一般步骤：
- 概述。作者陈述代码设计及其技术背景。有时候这个阶段可以忽略。
- 准备。各个评论员独立地对代码进行考察。
- 详查会议。挑选某个人阅读代码或者顺序解释代码逻辑，各个评论员提出自己认为的错误并进行讨论。当确认一个错误确实是错误后就停止，而不要纠结于如何改正之类的问题。主持人应该把握节奏，不要太快也不要太慢。
- 详查报告。
- 返工与跟进

对于详查，书中给出了一些小的建议。
首先，可以建立一个核对表，详查过程中提醒评论员尤其注意某些错误。
其次，详查不应该成为代码的公开处刑。应该避免一些过于苛刻的评论，作者也不应该因为自尊心而袒护自己的代码。

### 其他类型的协同开发

#### 走查
与正式检查类似，通常由代码的作者主持。焦点在于技术问题上。和详查一样，重点在于检测错误而非纠正错误。作者对走查的效果较为悲观。好的情况下，走查的效果和详查相近。然而很多情况下，非正式的走查效果很差。对其原因，作者并没有作出解释。不过作者指出，走查尽管非正式，仍然需要很高的成本，所以假如认为复查的需求真的足够迫切，就应该召开正式检查而非走查。否则，应该采用阅读代码等交互性较低的方式。

#### 代码阅读
- 准备阶段：将源代码交给阅读人员。
- 会议阶段：阅读人员指出自己发现的问题并进行讨论。

与详查、走查区别在于，代码阅读注意力集中在发现的问题上，而不需要一行行遍历代码。

## 第22章：开发者测试

分类：
- 单元测试。通常只涉及单个程序员或开发团队。
- 组件测试。似乎和单元测试差不多，不过会涉及多个程序员或开发团队。
- 集成测试。对多个组件进行联合测试，通常应该在有两个可供联合测试的类之后就尽快开始并持续到开发结束。
- 系统测试。主要针对安全、性能、资源消耗、时序、兼容性等问题。

### 开发者测试在软件质量中的角色

### 推荐方法

### 测试技巧锦囊

### 典型错误

### 改善测试过程

## 第23章：调试

### 调试概述

### 寻找缺陷

### 修正缺陷

### 调试中的心理因素

## 第24章：重构

### 重构的理由

### 特定的重构

### 安全的重构

### 重构策略

## 第25章：代码调整策略

### 性能概述

### 代码调整简介

### 蜜糖与哥斯拉

### 性能测量

### 反复调整

## 第26章：代码调整技术

### 逻辑

### 循环

### 数据变换

### 子程序

### 用低级语言重写代码

### 变得越多，事情反而越没变
