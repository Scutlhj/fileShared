# 读书笔记：Clean Code 与 The Clean Coder
## Clean Code (第14-17章)
### 第14章：渐进式改进
本章通过重构一个名为"Args"的命令行参数解析器，展示了如何将混乱的代码逐步转变为清晰、可维护的代码。初始版本的Args类虽然能工作，但结构混乱、错误处理不一致、职责不清晰。作者通过以下步骤进行重构：

- 首先确保有完善的测试覆盖，作为重构的安全网
- 从简单的命名改进开始，使代码更具可读性
- 将大型函数分解为更小、更专注的函数
- 提取参数类型处理逻辑到专门的类中
- 应用命令模式变体，为不同类型的参数创建专门的处理器
- 重构后的代码更加模块化、可扩展，且更易于理解和维护，同时保持了原有功能。

在平时开发项目中，渐进式改进可以通过以下步骤实现：

- 识别组件中的不同职责（如筛选、展示、交互）
- 创建小型、专注的子组件
- 定义清晰的组件接口（props和事件）
- 使用Vuex或Pinia管理复杂状态
- 在每一步后运行测试确保功能正常

```vue
<!-- 重构前：所有功能混在一个组件中 -->
<template>
  <div class="product-list">
    <input v-model="search" @input="filterProducts">
    <select v-model="category" @change="filterProducts">
      <option v-for="cat in categories" :key="cat">{{ cat }}</option>
    </select>
    <div v-for="product in filteredProducts" :key="product.id">
      {{ product.name }} - {{ product.price }}
      <button @click="addToCart(product)">添加到购物车</button>
    </div>
  </div>
</template>

<!-- 重构后：拆分为多个职责单一的组件 -->
<template>
  <div class="product-list">
    <ProductFilters 
      :categories="categories"
      @filter-change="applyFilters"
    />
    <ProductGrid 
      :products="filteredProducts"
      @add-to-cart="addToCart"
    />
  </div>
</template>
```

### 第15章：JUnit内幕
本章分析了JUnit框架中的ComparisonCompactor类，这个类用于生成两个不同字符串之间差异的报告。作者指出了原始代码中的几个问题：

- 变量命名不清晰（如f、p、s等）
- 过多的注释掩盖了代码本身的问题
- 部分方法过长且复杂
- 抽象级别混乱，高层次和低层次概念混在一起

通过重构，作者将代码转变为更清晰、更有表现力的形式。他重命名变量，提取方法，调整结构，使代码更易理解。重构后的代码不仅更短，而且逻辑更清晰，也更容易维护和扩展。

在本章，作者强调了测试代码同样需要保持整洁。我们平时主要使用的测试框架是Vitest，以下是一些编写测试代码的最佳实践：

- 测试命名需要清晰表达意图
- 单一断言原则，一个测试一个目标
- 使用测试工具函数，避免过多重复代码
- 避免实现细节的测试
- 清理测试产生的副作用，使用 beforeEach / afterEach 清理测试数据

### 第16章：重构SerialDate
本章分析并重构了JCommon库中的SerialDate类，这是一个处理日期的工具类。作者指出了原代码中的多个问题：

- 过多的注释，很多是多余的或过时的
- 类承担了太多不同的职责
- 许多应该是实例方法的功能被实现为静态方法
- 命名不一致，如方法名混用驼峰式和下划线式
- 存在重复代码和不必要的复杂性

重构过程中，作者应用了多种设计模式和原则：

- 使用抽象工厂创建日期实例
- 将月份和星期几转换为枚举类型
- 实现不可变对象模式
- 应用单一职责原则分离关注点

在前端老项目进行重构时，需要注意以下细节：
- 重构前端代码时，首先理解其意图和上下文
- 识别并消除重复代码，提取共用逻辑到工具函数或hooks中
- 改进命名，使变量、函数和组件名称能清晰表达其用途
- 重构时保持谨慎，特别是处理日期、时区等复杂逻辑时，需要编写测试用例保证功能正常
- 使用TypeScript增强类型安全，减少潜在错误

### 第17章：气味与启发
本章提供了一个全面的代码质量检查清单，作者称之为"代码气味"，它们是潜在问题的指标。这些气味分为多个类别：

#### 注释相关：
不恰当的信息：注释不应包含更适合版本控制的信息
废弃的注释：应删除过时或不准确的注释
冗余注释：不要注释那些从代码就能明显看出的内容
注释掉的代码：应该删除而不是注释掉不再使用的代码

#### 函数相关：
过多的参数：函数参数应该尽量少，最好不超过三个
输出参数：应避免使用输出参数，优先使用返回值
标记参数：布尔参数表明函数做了不止一件事，应拆分为多个函数
死函数：未使用的函数应该被删除

#### 一般性问题：
重复代码：是所有问题中最严重的，应该通过抽象消除
代码过于复杂：应该尽量简化逻辑，使代码易于理解
不恰当的抽象级别：代码应该在一致的抽象级别上操作

#### 命名相关：
不恰当的名称：名称应该揭示意图，清晰表达其用途
不一致的命名：同一概念应使用相同的命名约定

#### 测试相关：
测试不足：代码应该有充分的测试覆盖
忽略简单测试：即使是简单的代码也应该测试
测试边界条件：特别关注边界条件和异常情况

#### 前端开发最佳实践：
保持组件和方法简短，专注于单一职责
使用描述性的变量和方法名称
提取重复逻辑到共享组件或工具函数
编写单元测试验证组件行为
使用ESLint和Prettier等工具强制代码风格一致性
定期进行代码审查，识别和解决"代码气味"

## The Clean Coder (第1-4章)
### 第1章：专业主义
本章探讨了软件开发中的专业主义概念。作者分享了自己早期职业生涯中的一个故事，他在一个项目中承诺了不切实际的截止日期，导致团队疲惫不堪，最终交付了充满缺陷的软件。这个经历让他认识到专业开发者的核心责任：
- 对自己的代码负责：专业开发者不会制造缺陷，会主动测试自己的代码
- 持续学习：技术不断发展，专业人士必须投入时间学习新技能
- 知道自己的领域：了解业务领域和技术领域，能够提供有价值的建议
- 谦虚：承认自己的错误，愿意接受反馈和改进
- 实践：通过刻意练习提升技能，如编码练习、编程竞赛等

作为一名前端开发，以下我个人的一些建议：
- 对前端代码质量负责，不仅关注视觉效果，也关注性能、可访问性和用户体验
- 建立前端测试体系，包括单元测试、集成测试和端到端测试，确保代码质量
- 设定合理的期望，不承诺无法完成的截止日期，特别是对于复杂的UI交互以及功能
- 诚实地评估和沟通技术债务，不隐瞒前端架构中的问题
- 持续学习新的前端技术和最佳实践，跟上快速发展的前端生态

### 第2章：说不
本章讨论了在面对不合理要求时说"不"的重要性。作者分享了几个案例，包括一个开发团队被要求在不可能的时间内完成项目，结果导致质量问题和客户不满。他强调：

- 对不合理的期望说不：不要承诺无法实现的截止日期
- 对质量妥协说不：不要为了赶进度而牺牲代码质量
- 对有害的管理决策说不：当决策会导致项目失败时，有责任提出异议

作者提供了有效说"不"的策略：
- 提供数据和理由，而不仅仅是拒绝
- 提出替代方案，展示解决问题的意愿
- 保持专业和尊重，避免情绪化
- 理解团队目标，寻找共同利益

在平时的项目中，我们需要拒绝不合理的需求，同时提供合理的替代方案。以下是一些建议：
- 评估需求可行性‌：如产品经理要求“一周内重写整个前端”，应评估技术风险。
- 技术债务管理‌：明确告知不合理架构（如全局 CSS 污染）的长期成本。
- 提供准确的时间估算：基于经验和数据，而非乐观假设
- 建议功能优先级：帮助产品团队确定哪些功能最重要
- 提出技术替代方案：当原始需求难以实现时，提供替代技术方案

### 第3章：说是
本章探讨了如何做出并履行承诺。作者强调，说"是"意味着你承诺一定会完成，而不仅仅是尽力而为。他提出了"承诺语言"的概念，区分了不同级别的承诺：

- "我会尽力" - 不是真正的承诺，只表示意愿
- "我会尝试" - 暗示可能会失败，不是承诺
- "我会做" - 真正的承诺，表示一定会完成

当承诺一个功能实现时，应该：
- 分解任务并评估每个子任务时间
- 考虑联调、测试和意外情况的时间缓冲（如有其他任务冲突）
- 明确交付标准和验收条件
  
比如一个实现用户仪表盘的功能，可以分解为：
- 前端开发：3天
  - 搭建基础布局：1天
  - 集成数据可视化库：0.5天
  - 实现交互逻辑：1.5天
- 后端联调：1天
- 测试修复Bug：1天
总计：5个工作日（建议排期6天，含缓冲）

作者在讨论如何做出可靠承诺时，介绍了一种基于统计学的预估方法，通常称为"三点估算法"(Three-point estimation)。这个方法包括：
- 乐观估计 (O) - 如果一切顺利，任务完成所需的最短时间
- 标称估计 (N) - 最可能的完成时间
- 悲观估计 (P) - 考虑到可能的问题和风险，任务完成所需的最长时间
- 然后使用以下公式计算加权平均值：E = (O + 4N + P) / 6

这种方法可以更准确地预估任务完成时间。后续开发时可以使用这个方法进行预估，并根据实际情况进行调整。

### 第4章：编码
本章讨论了编码过程中的专业态度和实践。作者强调了在适当的精神状态下编码的重要性，以及如何处理常见的编码挑战：
- 准备状态：编码需要高度专注和清晰思考，应避免在疲劳、生病或情绪低落时编写重要代码
- 流畅状态：进入"心流"状态可以提高生产力，但也可能导致隧道视野，忽略更广泛的考虑
- 阻塞：当遇到困难问题时，可以采用结对编程、休息或转换任务等策略
- 调试：应采用科学方法进行调试，形成假设并验证，而非随机尝试
- 节奏：保持稳定的工作节奏，避免过度疲劳和"英雄主义"编程

作为一个程序员，想要编写出高质量的代码，需要保持专注、有条理和有策略。同时为了自己的身体健康，需要保持良好的生活习惯，如规律作息、健康饮食和定期锻炼。保持良好的精神状态和身体状态，才能更好地应对工作，做到细水长流。
